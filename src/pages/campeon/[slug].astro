---
import Layout from '../../layouts/Layout.astro';
import champions from '../../data/champions.json';

// 1. Generar todas las rutas basadas en el slug del JSON
export async function getStaticPaths() {
  return champions.map((champ) => ({
    params: { slug: champ.slug },
    props: { champ },
  }));
}

// 2. Obtener los datos del campe√≥n para esta p√°gina espec√≠fica
const { champ } = Astro.props;

// Colores de afinidad
const affinityColors = {
  'Fuerza': 'text-affinity-force',
  'Magia': 'text-affinity-magic',
  'Esp√≠ritu': 'text-affinity-spirit',
  'Vac√≠o': 'text-affinity-void',
} as const;

const affinityClass = affinityColors[champ.affinity as keyof typeof affinityColors] || 'text-white';

// Devuelve la variable CSS del color correspondiente a la rareza
function getRarityColorVar(rarity: string) {
  const map: Record<string, string> = {
    'Legendario': 'var(--color-raid-gold)',
    '√âpico': 'var(--color-raid-purple)',
    'Raro': 'var(--color-raid-blue)',
    'Com√∫n': 'rgba(120,120,120,1)'
  };
  return map[rarity] || 'var(--color-raid-gold)';
}

const rarityColorVar = getRarityColorVar(champ.rarity);
---

<Layout title={`${champ.name} - El Tomo Legendario`}>
  <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <!-- Header del Campe√≥n -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
      <!-- Imagen -->
      <div class="md:col-span-1 flex justify-center md:justify-start">
        <div class="relative group">
          <img 
            src={champ.image} 
            alt={champ.name} 
            class="w-48 rounded-lg border-4 border-raid-gold shadow-2xl transition-transform group-hover:scale-105 relative z-10"
          />

          <!-- Overlay degradado con color seg√∫n la rareza (usa variables CSS definidas en global.css) -->
          <div
            class="absolute inset-0 rounded-lg pointer-events-none z-0"
            style={`background: linear-gradient(180deg, ${rarityColorVar} 0%, rgba(10,14,20,0) 55%); opacity: 0.32;`}
          ></div>

          <!-- Halo sutil en la parte inferior para simular sombra de color -->
          <div
            class="absolute left-1/2 -translate-x-1/2 -bottom-3 w-36 h-6 rounded-full pointer-events-none z-0"
            style={`background: radial-gradient(ellipse at center, ${rarityColorVar} 0%, rgba(10,14,20,0) 60%); filter: blur(8px); opacity: 0.6;`}
          ></div>
        </div>
      </div>

      <!-- Informaci√≥n Principal -->
      <div class="md:col-span-2 flex flex-col justify-start">
        <h1 class="text-5xl font-black text-raid-gold mb-4 uppercase tracking-tight">
          {champ.name}
        </h1>
        
        <!-- Metadata -->
        <div class="flex flex-wrap gap-2 mb-6">
          <span class={`px-3 py-1 bg-raid-card rounded-full font-bold text-xs ${affinityClass}`}>
            {champ.affinity}
          </span>
          <span class="px-3 py-1 bg-raid-card rounded-full font-bold text-xs text-raid-gold">
            {champ.rarity}
          </span>
          <span class="px-3 py-1 bg-raid-card rounded-full font-bold text-xs text-gray-300">
            {champ.type}
          </span>
          <span class="px-3 py-1 bg-raid-card rounded-full font-bold text-xs text-gray-400">
            {champ.faction}
          </span>
        </div>

        <!-- Descripci√≥n Rol -->
        <p class="text-gray-300 italic bg-raid-card p-3 rounded-lg border-l-4 border-raid-gold mb-6 text-sm">
          {champ.role || "Rol no definido en el tomo a√∫n."}
        </p>

        <!-- Stats Base Completas - Ordenadas -->
        <h3 class="text-sm font-bold text-raid-gold mb-3 uppercase">Estad√≠sticas Base</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-xs">
          {[
            { label: 'HP', value: champ.stats?.hp || 0 },
            { label: 'ATK', value: champ.stats?.attack || 0 },
            { label: 'DEF', value: champ.stats?.defense || 0 },
            { label: 'VEL', value: champ.stats?.speed || 0 },
            { label: 'P.CRIT', value: champ.stats?.critRate || 0 },
            { label: 'D.CRIT', value: champ.stats?.critDamage || 0 },
            { label: 'RES', value: champ.stats?.resistance || 0 },
            { label: 'PUNT', value: champ.stats?.accuracy || 0 },
          ].map((stat) => (
            <div class="bg-raid-bg p-2 rounded border border-gray-700">
              <p class="text-gray-400 uppercase font-bold">{stat.label}</p>
              <p class="text-raid-gold font-bold">{stat.value}</p>
            </div>
          ))}
        </div>
      </div>
    </div>

    <!-- Tabs Navigation -->
    <div class="mb-8">
      <div class="flex overflow-x-auto gap-2 border-b border-gray-700 pb-0" role="tablist">
        <button data-tab="galeria" class="tab-button active px-4 py-3 font-semibold border-b-2 border-raid-gold text-raid-gold whitespace-nowrap">
          Galer√≠a
        </button>
        <button data-tab="habilidades" class="tab-button px-4 py-3 font-semibold border-b-2 border-transparent text-gray-400 hover:text-white whitespace-nowrap">
          Habilidades
        </button>
        <button data-tab="builds" class="tab-button px-4 py-3 font-semibold border-b-2 border-transparent text-gray-400 hover:text-white whitespace-nowrap">
          Builds
        </button>
        <button data-tab="maestrias" class="tab-button px-4 py-3 font-semibold border-b-2 border-transparent text-gray-400 hover:text-white whitespace-nowrap">
          Maestr√≠as
        </button>
        <button data-tab="libros" class="tab-button px-4 py-3 font-semibold border-b-2 border-transparent text-gray-400 hover:text-white whitespace-nowrap">
          Prioridad Libros
        </button>
        <button data-tab="modos" class="tab-button px-4 py-3 font-semibold border-b-2 border-transparent text-gray-400 hover:text-white whitespace-nowrap">
          Mejores Modos
        </button>
        <button data-tab="sinergias" class="tab-button px-4 py-3 font-semibold border-b-2 border-transparent text-gray-400 hover:text-white whitespace-nowrap">
          Sinergias
        </button>
        <button data-tab="proscontras" class="tab-button px-4 py-3 font-semibold border-b-2 border-transparent text-gray-400 hover:text-white whitespace-nowrap">
          Pros / Contras
        </button>
      </div>
    </div>

    <!-- Tab Content -->
    <div class="space-y-8">
      <!-- Galer√≠a Tab -->
      <section id="galeria" class="tab-content">
        <h2 class="text-3xl font-bold mb-6 text-white">Galer√≠a de Arte</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <!-- Card principal -->
          <div class="group relative overflow-hidden rounded-lg border border-gray-700 hover:border-raid-gold transition-all duration-300 lg:col-span-1 lg:row-span-2">
            <img 
              src={champ.image} 
              alt={champ.name}
              class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
            />
            <div class="absolute inset-0 bg-linear-to-t from-raid-bg via-transparent to-transparent opacity-60"></div>
            <div class="absolute bottom-0 left-0 right-0 p-4">
              <p class="text-raid-gold font-bold">Ilustraci√≥n Principal</p>
              <p class="text-gray-400 text-sm">{champ.name}</p>
            </div>
          </div>

          <!-- Placeholder cards para artes adicionales -->
          {[1, 2, 3, 4].map((i) => (
            <div class="group relative overflow-hidden rounded-lg border border-gray-700 hover:border-raid-purple transition-all duration-300 bg-raid-card aspect-square flex items-center justify-center">
              <div class="text-center">
                <div class="text-4xl mb-2">üé®</div>
                <p class="text-gray-400 text-sm">Arte {i}</p>
                <p class="text-gray-500 text-xs mt-2">Por actualizarse</p>
              </div>
            </div>
          ))}
        </div>
        <div class="mt-6 bg-raid-bg p-6 rounded-lg border border-gray-700">
          <p class="text-gray-400 text-center">M√°s artes y skins del campe√≥n se agregar√°n pr√≥ximamente.</p>
        </div>
      </section>

      <!-- Habilidades Tab -->
      <section id="habilidades" class="tab-content hidden">
        <h2 class="text-3xl font-bold mb-6 text-white">Habilidades</h2>
        <div class="space-y-6">
          {champ.skills && champ.skills.map((skill, index) => (
            <div class="bg-raid-card p-6 rounded-lg border border-gray-700 hover:border-raid-gold transition-colors">
              <div class="flex justify-between items-start mb-3">
                <div>
                  <h3 class="text-2xl font-bold text-raid-gold">{skill.name}</h3>
                  {index === 0 && <p class="text-xs text-gray-400">Habilidad Pasiva</p>}
                  {index > 0 && <p class="text-xs text-gray-400">Habilidad Activa (CD: {skill.cooldown || 0})</p>}
                </div>
                {skill.multiplier && (
                  <span class="bg-raid-bg text-xs px-3 py-1 rounded-lg text-green-400 font-mono border border-gray-700">
                    {skill.multiplier}
                  </span>
                )}
              </div>
              <p class="text-gray-300 leading-relaxed">{skill.description}</p>
              {skill.levels && (
                <div class="mt-4 pt-4 border-t border-gray-700">
                  <p class="text-xs text-gray-400 font-semibold mb-2">Mejoras por nivel:</p>
                  <ul class="text-sm text-gray-400 space-y-1">
                    {skill.levels.map((level) => (
                      <li>‚Ä¢ {level}</li>
                    ))}
                  </ul>
                </div>
              )}
            </div>
          ))}
        </div>
      </section>

      <!-- Builds Tab -->
      <section id="builds" class="tab-content hidden">
        <h2 class="text-3xl font-bold mb-6 text-white">Builds Recomendadas</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="bg-raid-card p-6 rounded-lg border-l-4 border-raid-gold">
            <h3 class="text-xl font-bold text-raid-gold mb-4">Build PvE (Campaign)</h3>
            <div class="space-y-2 text-gray-300">
              <p><span class="text-raid-gold font-semibold">Tipo de Artefacto:</span> Ataque / Cr√≠tico</p>
              <p><span class="text-raid-gold font-semibold">Stats Principales:</span> ATK, Vel, DA√ë CR√çTICO</p>
              <p><span class="text-raid-gold font-semibold">Resistencia:</span> 150+</p>
            </div>
          </div>
          <div class="bg-raid-card p-6 rounded-lg border-l-4 border-raid-purple">
            <h3 class="text-xl font-bold text-raid-purple mb-4">Build Arena</h3>
            <div class="space-y-2 text-gray-300">
              <p><span class="text-raid-purple font-semibold">Tipo de Artefacto:</span> Defensa / Velocidad</p>
              <p><span class="text-raid-purple font-semibold">Stats Principales:</span> SPD, DEF, HP</p>
              <p><span class="text-raid-purple font-semibold">Resistencia:</span> 200+</p>
            </div>
          </div>
        </div>
        <div class="mt-6 bg-raid-bg p-6 rounded-lg border border-gray-700">
          <p class="text-gray-400 text-center">Las builds espec√≠ficas se actualizar√°n pr√≥ximamente con an√°lisis detallados.</p>
        </div>
      </section>

      <!-- Maestr√≠as Tab -->
      <section id="maestrias" class="tab-content hidden">
        <h2 class="text-3xl font-bold mb-6 text-white">Maestr√≠as</h2>
        <div class="bg-raid-bg p-8 rounded-lg border border-gray-700">
          <p class="text-gray-400 text-center mb-6">Informaci√≥n de maestr√≠as en desarrollo.</p>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-raid-card p-4 rounded-lg border border-gray-700">
              <h3 class="text-raid-gold font-bold mb-3">√Årbol Ofensivo</h3>
              <p class="text-gray-400 text-sm">Selecciona las maestr√≠as que potencien tu da√±o y ATK.</p>
            </div>
            <div class="bg-raid-card p-4 rounded-lg border border-gray-700">
              <h3 class="text-raid-purple font-bold mb-3">√Årbol de Apoyo</h3>
              <p class="text-gray-400 text-sm">Maestr√≠as defensivas y de utilidad.</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Prioridad de Libros Tab -->
      <section id="libros" class="tab-content hidden">
        <h2 class="text-3xl font-bold mb-6 text-white">Prioridad de Libros</h2>
        <div class="space-y-4">
          {champ.skills && champ.skills.map((skill, index) => (
            <div class="bg-raid-card p-4 rounded-lg border border-gray-700 flex items-center gap-4">
              <div class="bg-raid-bg p-3 rounded-lg font-bold text-raid-gold w-12 h-12 flex items-center justify-center">
                {index + 1}
              </div>
              <div class="flex-1">
                <h3 class="font-bold text-white">{skill.name}</h3>
                <p class="text-gray-400 text-sm">Prioridad: {index === 0 ? 'M√°xima' : index === 1 ? 'Alta' : 'Media'}</p>
              </div>
            </div>
          ))}
        </div>
      </section>

      <!-- Mejores Modos de Juego Tab -->
      <section id="modos" class="tab-content hidden">
        <h2 class="text-3xl font-bold mb-6 text-white">Mejores Modos de Juego</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="bg-linear-to-br from-raid-gold/20 to-transparent p-6 rounded-lg border border-raid-gold">
            <h3 class="text-raid-gold font-bold text-lg mb-3">Campaign</h3>
            <p class="text-gray-300 text-sm">Excelente para farmear oro y experiencia en etapas tempranas.</p>
          </div>
          <div class="bg-linear-to-br from-raid-purple/20 to-transparent p-6 rounded-lg border border-raid-purple">
            <h3 class="text-raid-purple font-bold text-lg mb-3">Dungeons</h3>
            <p class="text-gray-300 text-sm">Bueno en mazmorras seleccionadas, verificar sinergias.</p>
          </div>
          <div class="bg-linear-to-br from-raid-blue/20 to-transparent p-6 rounded-lg border border-raid-blue">
            <h3 class="text-raid-blue font-bold text-lg mb-3">Arena</h3>
            <p class="text-gray-300 text-sm">√ötil en composiciones espec√≠ficas, requiere apoyo.</p>
          </div>
        </div>
      </section>

      <!-- Sinergias Tab -->
      <section id="sinergias" class="tab-content hidden">
        <h2 class="text-3xl font-bold mb-6 text-white">Sinergias</h2>
        <div class="space-y-6">
          <div class="bg-raid-card p-6 rounded-lg border border-gray-700">
            <h3 class="text-raid-gold font-bold text-lg mb-4">Sinergia con Campeones</h3>
            <p class="text-gray-400">Las mejores combinaciones se actualizar√°n pr√≥ximamente con an√°lisis de sinergias espec√≠ficas.</p>
          </div>
          <div class="bg-raid-card p-6 rounded-lg border border-gray-700">
            <h3 class="text-raid-purple font-bold text-lg mb-4">Efectos de Equipo</h3>
            <p class="text-gray-400">Combina artefactos para potenciar sus estad√≠sticas y habilidades al m√°ximo.</p>
          </div>
        </div>
      </section>

      <!-- Pros / Contras Tab -->
      <section id="proscontras" class="tab-content hidden">
        <h2 class="text-3xl font-bold mb-6 text-white">Pros y Contras</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          <!-- Pros -->
          <div>
            <h3 class="text-2xl font-bold text-green-400 mb-4">‚úì Ventajas</h3>
            <ul class="space-y-3">
              <li class="flex items-start gap-3">
                <span class="text-green-400 font-bold text-xl">+</span>
                <span class="text-gray-300">Habilidades vers√°tiles y √∫tiles</span>
              </li>
              <li class="flex items-start gap-3">
                <span class="text-green-400 font-bold text-xl">+</span>
                <span class="text-gray-300">Buenas estad√≠sticas base</span>
              </li>
              <li class="flex items-start gap-3">
                <span class="text-green-400 font-bold text-xl">+</span>
                <span class="text-gray-300">Funciona en m√∫ltiples modos</span>
              </li>
            </ul>
          </div>

          <!-- Contras -->
          <div>
            <h3 class="text-2xl font-bold text-red-400 mb-4">‚úó Desventajas</h3>
            <ul class="space-y-3">
              <li class="flex items-start gap-3">
                <span class="text-red-400 font-bold text-xl">-</span>
                <span class="text-gray-300">Requiere inversi√≥n de libros</span>
              </li>
              <li class="flex items-start gap-3">
                <span class="text-red-400 font-bold text-xl">-</span>
                <span class="text-gray-300">Sinergias limitadas</span>
              </li>
              <li class="flex items-start gap-3">
                <span class="text-red-400 font-bold text-xl">-</span>
                <span class="text-gray-300">No es meta en endgame</span>
              </li>
            </ul>
          </div>
        </div>
      </section>
    </div>
  </main>

  <script>
    // Tab switching functionality
    document.querySelectorAll('.tab-button').forEach(button => {
      button.addEventListener('click', () => {
        const tabName = button.dataset.tab;

        // Remove active class from all buttons and hide all content
        document.querySelectorAll('.tab-button').forEach(btn => {
          btn.classList.remove('active', 'border-raid-gold', 'text-raid-gold');
          btn.classList.add('border-transparent', 'text-gray-400');
        });

        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.add('hidden');
        });

        // Add active class to clicked button and show content
        button.classList.add('active', 'border-raid-gold', 'text-raid-gold');
        button.classList.remove('border-transparent', 'text-gray-400');
        document.getElementById(tabName).classList.remove('hidden');
      });
    });
  </script>
</Layout>